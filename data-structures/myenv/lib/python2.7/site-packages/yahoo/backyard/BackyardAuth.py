import requests

import yahoo.backyard


class BackyardAuth(requests.auth.AuthBase):
    """Attaches a backyard cookie to a given request object."""
    def __init__(self, user=None, password=None, auth_uri=None):
        self.user = user
        self.password = password
        self.auth_uri = auth_uri
        self.cookies = {}
        # populate cookies
        self.refresh()

    def __call__(self, r):
        r.prepare_cookies(self.cookies)

        return r

    def refresh(self):
        """(Re)populate our Bouncer cookies.

        Can also be used when existing cookies expire.
        """
        self.cookies = yahoo.backyard.get_cookie_dict(user=self.user,
                                                      password=self.password,
                                                      auth_uri=self.auth_uri)
